{% extends "base.html" %}
{% load static %}

{% block title %}Checkout | Le Frat{% endblock %}

{% block content %}
<h1>Checkout</h1>

<h2>Order Summary</h2>

{% if bag_items %}
  <ul>
    {% for item in bag_items %}
      <li>
        {{ item.product.name }} x {{ item.quantity }}
        — ${{ item.line_total }}
      </li>
    {% endfor %}
  </ul>
  <p><strong>Total:</strong> ${{ total }}</p>
{% else %}
  <p>Your bag is empty.</p>
{% endif %}

<hr>

<form method="POST" id="payment-form">
  {% csrf_token %}
  {{ order_form.as_p }}

  
  <div id="card-element"></div>
  <div id="card-errors" role="alert"></div>

  <button type="submit" id="submit-button">Pay</button>
</form>

<!-- ✅ Send values from Django context into JS safely -->
{{ stripe_public_key|json_script:"id_stripe_public_key" }}
{{ client_secret|json_script:"id_client_secret" }}
<script src="https://js.stripe.com/v3/"></script>
<!-- This should be the JS file you create for Stripe Elements -->
<script src="{% static 'js/stripe_elements.js' %}"></script>
{% endblock %}
