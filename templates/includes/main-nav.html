{% load static %}

<nav class="lf-nav">
  <div class="lf-nav__inner">

    <!-- LEFT -->
    <div class="lf-nav__left">
      <div class="lf-nav__dropdown">
        <button class="lf-nav__link lf-nav__dropdown-btn" type="button">
          CATEGORIES
        </button>

        <div class="lf-nav__dropdown-menu">
          {% for c in nav_categories %}
            <a class="lf-nav__dropdown-item" href="{% url 'products' %}?category={{ c.name }}">
              {{ c.friendly_name }}
            </a>
          {% endfor %}
        </div>
      </div>

      <a class="lf-nav__link" href="{% url 'products' %}">SHOP</a>
      <a class="lf-nav__link" href="{% url 'products' %}?sort=newest">NEW ARRIVALS</a>
    </div>

    <!-- CENTER -->
    <div class="lf-nav__center">
      <a class="lf-nav__logo" href="{% url 'home' %}">LE FRAT</a>
    </div>

    <!-- RIGHT -->
    <div class="lf-nav__right">
      <div class="lf-nav__search-wrap">
        <button class="lf-nav__icon-btn lf-nav__search-toggle" type="button" aria-label="Open search">
          <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
            <path fill="currentColor"
              d="M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16Zm0-2a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm9.707 5.293-4.11-4.11a1 1 0 0 0-1.414 1.414l4.11 4.11a1 1 0 0 0 1.414-1.414Z"/>
          </svg>
        </button>

        <button class="lf-burger" type="button" aria-label="Open menu" aria-expanded="false">
          <span></span><span></span><span></span>
        </button>

        <form class="lf-nav__search-pop" method="GET" action="{% url 'products' %}" role="search">
          <input
            type="search"
            name="q"
            class="lf-nav__search-input"
            placeholder="Search"
            aria-label="Search products"
          >
        </form>
      </div>

      <script>
        (function () {
          const wrap = document.querySelector(".lf-nav__search-wrap");
          if (!wrap) return;

          const toggle = wrap.querySelector(".lf-nav__search-toggle");
          const form = wrap.querySelector(".lf-nav__search-pop");
          const input = wrap.querySelector("input[name='q']");

          function openSearch() {
            form.classList.add("is-open");
            toggle.setAttribute("aria-expanded", "true");
            setTimeout(() => input && input.focus(), 0);
          }

          function closeSearch() {
            form.classList.remove("is-open");
            toggle.setAttribute("aria-expanded", "false");
          }

          toggle.addEventListener("click", (e) => {
            e.stopPropagation();
            form.classList.contains("is-open") ? closeSearch() : openSearch();
          });

          document.addEventListener("click", (e) => {
            if (!wrap.contains(e.target)) closeSearch();
          });

          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") closeSearch();
          });
        })();
      </script>

      <!-- Hamburger mobile menu -->
      <div class="lf-mobile" id="lfMobileMenu" hidden aria-hidden="true">
        <div class="lf-mobile__panel" role="dialog" aria-modal="true" aria-label="Mobile menu">
          <div class="lf-mobile__top">
            <span class="lf-mobile__brand">LE FRAT</span>
            <button class="lf-mobile__close" type="button" aria-label="Close menu">âœ•</button>
          </div>

          <nav class="lf-mobile__links">
            <a href="{% url 'products' %}?category=categories">Categories</a>
            <a href="{% url 'products' %}">Shop</a>
            <a href="{% url 'products' %}?sort=newest">New Arrivals</a>
          </nav>

          <div class="lf-mobile__actions">
            <a class="lf-mobile__btn" href="{% url 'products' %}?q=">Search</a>

            {% if request.user.is_authenticated %}
              <a class="lf-mobile__btn" href="{% url 'profile' %}">My Profile</a>
              <a class="lf-mobile__btn" href="{% url 'account_logout' %}">Logout</a>
            {% else %}
              <a class="lf-mobile__btn" href="{% url 'account_login' %}">Login</a>
              <a class="lf-mobile__btn" href="{% url 'account_signup' %}">Sign Up</a>
            {% endif %}

            <a class="lf-mobile__btn lf-mobile__btn--primary" href="{% url 'view_bag' %}">
              Bag {% if product_count %}({{ product_count }}){% endif %}
            </a>
          </div>
        </div>
      </div>

      <div class="lf-nav__account">
        <button class="lf-nav__icon-btn" type="button" aria-label="Account">
          <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
            <path fill="currentColor" d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z"/>
          </svg>
        </button>

        <div class="lf-nav__account-menu">
          {% if request.user.is_authenticated %}
            <a href="{% url 'profile' %}">Profile</a>
            <a href="{% url 'account_logout' %}">Logout</a>
          {% else %}
            <a href="{% url 'account_login' %}">Login</a>
            <a href="{% url 'account_signup' %}">Sign Up</a>
          {% endif %}
        </div>
      </div>

      <a class="lf-nav__icon-btn lf-nav__icon-btn--bag" href="{% url 'view_bag' %}" aria-label="Bag">
        <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
          <path fill="currentColor" d="M7 7V6a5 5 0 0 1 10 0v1h3l-1 15H5L4 7h3Zm2 0h6V6a3 3 0 0 0-6 0v1Z"/>
        </svg>

        {% if product_count %}
          <span class="lf-nav__badge">{{ product_count }}</span>
        {% endif %}
      </a>

    </div>
  </div>
</nav>
