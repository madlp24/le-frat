{% extends "base.html" %}

{% block title %}Shop | Le Frat{% endblock %}

{% block content %}
<div class="container py-4">

  {# ---------- Page Header ---------- #}
  <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3 mb-4">
    <h1>Shop</h1>

    {% if request.user.is_staff %}
      <a href="{% url 'add_product' %}" class="btn btn-primary">
        Add Product
      </a>
    {% endif %}
  </div>

  {# ---------- Search / Filter / Sort ---------- #}
  <form method="GET" action="{% url 'products' %}" class="d-flex flex-column flex-lg-row gap-2 mb-4">
    <input
      type="search"
      name="q"
      class="form-control"
      placeholder="Search products"
      value="{{ search_term }}"
      aria-label="Search"
    >

    <select name="category" class="form-select">
      <option value="">All categories</option>
      {% for c in categories %}
        <option value="{{ c.name }}" {% if selected_category == c.name %}selected{% endif %}>
          {{ c.friendly_name }}
        </option>
      {% endfor %}
    </select>

    <select name="sort" class="form-select">
      <option value="">Sort by</option>
      <option value="price_asc" {% if selected_sort == "price_asc" %}selected{% endif %}>Price: Low → High</option>
      <option value="price_desc" {% if selected_sort == "price_desc" %}selected{% endif %}>Price: High → Low</option>
      <option value="name_asc" {% if selected_sort == "name_asc" %}selected{% endif %}>Name: A → Z</option>
      <option value="name_desc" {% if selected_sort == "name_desc" %}selected{% endif %}>Name: Z → A</option>
    </select>

    <button type="submit" class="btn btn-primary">
      Apply
    </button>

    {% if search_term or selected_category or selected_sort %}
      <a href="{% url 'products' %}" class="btn btn-outline-secondary">
        Clear
      </a>
    {% endif %}
  </form>

  {# ---------- Active Filters Info ---------- #}
  {% if search_term or selected_category %}
    <p class="text-muted mb-3">
      {% if search_term %}
        Searching: <strong>{{ search_term }}</strong>
      {% endif %}
      {% if selected_category %}
        | Category: <strong>{{ selected_category }}</strong>
      {% endif %}
    </p>
  {% endif %}

  {# ---------- Products Grid ---------- #}
  {% if products %}
    <div class="row g-4">
      {% for product in products %}
        <div class="col-12 col-sm-6 col-lg-4">
          <div class="card h-100">

            {% if product.image %}
              <img
                src="{{ product.image.url }}"
                class="card-img-top"
                alt="{{ product.name }}"
              >
            {% endif %}

            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ product.name }}</h5>

              <p class="card-text fw-bold mb-3">
                ${{ product.price }}
              </p>

              <a
                href="{% url 'product_detail' product.id %}"
                class="btn btn-primary mt-auto"
              >
                View
              </a>

              {% if request.user.is_staff %}
                <div class="mt-3">
                  <a
                    href="{% url 'edit_product' product.id %}"
                    class="btn btn-sm btn-outline-primary me-2"
                  >
                    Edit
                  </a>
                  <a
                    href="{% url 'delete_product' product.id %}"
                    class="btn btn-sm btn-outline-danger"
                  >
                    Delete
                  </a>
                </div>
              {% endif %}
            </div>

          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-light border text-center">
      <p class="fw-bold mb-1">No results found.</p>
      <p class="mb-0">Try a different search or clear filters.</p>
    </div>
  {% endif %}

</div>
{% endblock %}
