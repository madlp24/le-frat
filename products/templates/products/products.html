{% extends "base.html" %}

{% block title %}New Arrivals | Le Frat{% endblock %}

{% block content %}
<div class="container py-4">

  {# ---------- Collection Header (Full Send vibe) ---------- #}
  <header class="lf-collection-header mb-4">
    <div class="lf-collection-header__top">
      <div>
        <p class="lf-eyebrow m-0">LE FRAT</p>
        <h1 class="lf-collection-title m-0">New Arrivals</h1>
        <p class="lf-collection-subtitle m-0">
          Burgers. Sin pretensiones. Entre amigos.
        </p>
      </div>

      {% if request.user.is_staff %}
        <a href="{% url 'add_product' %}" class="btn btn-primary lf-btn-pill">
          Add Product
        </a>
      {% endif %}
    </div>
  </header>

  {# ---------- Search / Filter / Sort Bar ---------- #}
  <form method="GET" action="{% url 'products' %}" class="lf-toolbar mb-4">
    <div class="lf-toolbar__row">
      <div class="lf-toolbar__field lf-toolbar__search">
        <input
          type="search"
          name="q"
          class="form-control lf-input"
          placeholder="Search"
          value="{{ search_term }}"
          aria-label="Search"
        >
      </div>

      <div class="lf-toolbar__field">
        <select name="category" class="form-select lf-select">
          <option value="">All categories</option>
          {% for c in categories %}
            <option value="{{ c.name }}" {% if selected_category == c.name %}selected{% endif %}>
              {{ c.friendly_name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="lf-toolbar__field">
        <select name="sort" class="form-select lf-select">
          <option value="">Sort</option>
          <option value="price_asc" {% if selected_sort == "price_asc" %}selected{% endif %}>Price: Low → High</option>
          <option value="price_desc" {% if selected_sort == "price_desc" %}selected{% endif %}>Price: High → Low</option>
          <option value="name_asc" {% if selected_sort == "name_asc" %}selected{% endif %}>Name: A → Z</option>
          <option value="name_desc" {% if selected_sort == "name_desc" %}selected{% endif %}>Name: Z → A</option>
        </select>
      </div>

      <div class="lf-toolbar__actions">
        <button type="submit" class="btn btn-primary lf-btn-pill">Apply</button>

        {% if search_term or selected_category or selected_sort %}
          <a href="{% url 'products' %}" class="btn btn-outline-secondary lf-btn-pill">
            Clear
          </a>
        {% endif %}
      </div>
    </div>

    {% if search_term or selected_category %}
      <div class="lf-toolbar__meta">
        <span class="text-muted">
          {% if search_term %}Searching: <strong>{{ search_term }}</strong>{% endif %}
          {% if selected_category %} · Category: <strong>{{ selected_category }}</strong>{% endif %}
        </span>
      </div>
    {% endif %}
  </form>

  {# ---------- Products Grid ---------- #}
  {% if products %}
    <div class="row g-4">
      {% for product in products %}
        <div class="col-12 col-sm-6 col-lg-4">
          <div class="card lf-product-card h-100">

            <a href="{% url 'product_detail' product.id %}" class="lf-product-card__media">
              {% if product.image %}
                <img
                  src="{{ product.image.url }}"
                  class="lf-product-card__img"
                  alt="{{ product.name }}"
                  loading="lazy"
                >
              {% else %}
                <div class="lf-product-card__img lf-product-card__img--placeholder"></div>
              {% endif %}
            </a>

            <div class="card-body lf-product-card__body">
              <div class="lf-product-card__top">
                <h3 class="lf-product-name m-0">
                  <a href="{% url 'product_detail' product.id %}" class="lf-product-link">
                    {{ product.name }}
                  </a>
                </h3>

                <p class="lf-product-price m-0">${{ product.price }}</p>
              </div>

              <div class="lf-product-card__bottom">
                <a href="{% url 'product_detail' product.id %}" class="btn btn-primary lf-btn-pill w-100">
                  View
                </a>

                {% if request.user.is_staff %}
                  <div class="lf-admin-row">
                    <a href="{% url 'edit_product' product.id %}" class="btn btn-sm btn-outline-primary lf-btn-pill">
                      Edit
                    </a>
                    <a href="{% url 'delete_product' product.id %}" class="btn btn-sm btn-outline-danger lf-btn-pill">
                      Delete
                    </a>
                  </div>
                {% endif %}
              </div>
            </div>

          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-light border text-center lf-empty-state">
      <p class="fw-bold mb-1">No results found.</p>
      <p class="mb-0">Try a different search or clear filters.</p>
    </div>
  {% endif %}

</div>
{% endblock %}
